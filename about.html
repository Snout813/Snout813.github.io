<!DOCTYPE html>
<html>
<head>
  <title>프로젝트 정보 확인</title>
  <link rel="stylesheet" type="text/css" href="about.css">

</head>
<body>
  <h1>프로젝트 정보 확인</h1>
  <div id="projectInfo"></div>
  <div><button id="delete">삭제</button></div>
  <!-- Firebase SDK 로드 -->
  <script src="https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore.js"></script>

  <script type="module">
    // Firebase 프로젝트 구성으로 대체합니다.
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
    import { getFirestore, collection, query, where, getDocs, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore.js";
    const deleteButton = document.getElementById("delete");
    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
        // Firebase 설정 정보 입력
        apiKey: "AIzaSyBSebTrjnGqnwZmYe4MvCCK02nhvTyDB2Q",
        authDomain: "sle-web-64734.firebaseapp.com",
        projectId: "sle-web-64734",
        storageBucket: "sle-web-64734.appspot.com",
        messagingSenderId: "22889544223",
        appId: "1:22889544223:web:041ca634e846ee42eb332a", 
        measurementId: "G-ML4269WMVH"
    };
    
    // Firebase 초기화
    const app = initializeApp(firebaseConfig);
    // Firestore 데이터베이스에 대한 참조를 가져옵니다.
    const db = getFirestore(app); 

    // URL 파라미터에서 title 정보 읽어오기
    if(localStorage.getItem('title')){
      var title = localStorage.getItem('title')
    }

    // title 정보 사용 예시
    if (title) {
      // title 정보를 이용하여 필요한 작업 수행
      // 데이터 표시 함수 호출
      fetchDataByTitle(title);
    } else {
      // title 정보가 없을 경우에 대한 처리 (예: 기본값으로 데이터 표시 등)
    }
    
    // 원하는 정보를 가져와서 화면에 표시하는 함수
    async function fetchDataByTitle(title) {
      const dataListDiv = document.getElementById('projectInfo'); // 변경된 ID 사용
      try {
        // "projects" 컬렉션에서 title 필드와 일치하는 문서들을 가져오는 쿼리 생성 (Firebase에서 "projects" 컬렉션 이름으로 가정합니다)
        const q = query(collection(db, "users"), where("title", "==", title));
        const querySnapshot = await getDocs(q);

        // 가져온 문서들을 화면에 표시
        querySnapshot.forEach((doc) => {
          const data = doc.data();
          const itemDiv = document.createElement('div');
          itemDiv.innerHTML = `
            <h2>${data.title}</h2>
            <p><strong>년도:</strong> ${data.year}</p>
            <p><strong>학기:</strong> ${data.semester}</p>
            <p><strong>팀원:</strong> ${data.team}</p>
            <p><strong>프로젝트 형태:</strong> ${data.projectType}</p>
            <p><strong>프로젝트 링크:</strong> ${data.projectLink}</p>
            <p><strong>설명:</strong> ${data.description}</p>
            <hr>
          `;
          dataListDiv.appendChild(itemDiv);
        });
      } catch (error) {
        console.error("Error fetching documents: ", error);
      }
    }
    // 삭제 버튼 클릭 이벤트 처리 함수
    deleteButton.addEventListener("click", () => {
      const confirmation = confirm("정말로 문서를 삭제하시겠습니까?");
      if (confirmation) {
        try {
          // 해당 문서를 찾아서 삭제
          const q = query(collection(db, "users"), where("title", "==", title));
          getDocs(q).then(querySnapshot => {
            const deletePromises = [];
            querySnapshot.forEach((doc) => {
              deletePromises.push(deleteDoc(doc.ref));
            });
            return Promise.all(deletePromises);
          }).then(() => {
            alert("문서가 성공적으로 삭제되었습니다.");
            // 삭제 후 project.html로 이동
            window.location.href = "project.html";
          }).catch(error => {
            console.error("Error deleting document: ", error);
          });
        } catch (error) {
          console.error("Error deleting document: ", error);
        }
      } else {
        console.log("문서 삭제가 취소되었습니다.");
      }
    });
  </script>
</body>
</html>
